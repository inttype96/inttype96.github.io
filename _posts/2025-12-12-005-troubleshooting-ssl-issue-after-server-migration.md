---
title: "서버 이전 후 발생한 외부 API 응답 실패, 원인은 SSL 설정" 
slug: troubleshooting-ssl-issue-after-server-migration
description: >-
  윈도우 IIS 환경에서 문제없이 동작하던 서비스가 Docker와 Nginx 환경으로
  이전된 이후 외부 API 응답을 받지 못하는 문제가 발생했습니다. 
  해당 문제의 원인 분석 과정과 SSL 보안 설정으로 이어진 트러블슈팅 경험을 정리했습니다. 
author: inttype
date: 2025-12-12 22:45:00 +0900
categories: [Infra, Nginx]
tags: [nginx, ssl, tls, server-migration, docker, api, troubleshooting, infra, security]
pin: false
---

## 서버 이전 과정에서 발생했던 SSL 설정 이슈 정리

윈도우 IIS 환경에서 문제없이 동작하던 서비스가  
우분투 서버 + Docker + Nginx 환경으로 이전된 이후,  
**외부 API 응답을 정상적으로 받지 못해 DB 저장이 되지 않는 문제**가 발생한 적이 있었습니다.

처음에는 애플리케이션 로직이나 DB 커넥션 문제를 의심했지만,  
결론적으로 원인은 **Nginx의 SSL 보안 설정**에 있었습니다.

---

## 문제 인지까지의 과정 (개인적인 경험)

이 문제를 처음 전해들었을 당시,  
저는 해당 프로젝트를 맡은 지 **약 일주일 정도 지난 시점**이었습니다.

서버 이전 작업 자체는 제가 진행한 것이 아니었고,  
문제 또한 그 이전부터 존재하고 있던 상황이었습니다.  
다만 당시에는 다른 업무 우선순위로 인해 원인 분석이 미뤄져 있었고,  
제가 새로 담당하게 되면서 본격적으로 확인하게 되었습니다.

당시 해당 이슈로 인해 서비스는 여전히 윈도우 서버에서 운영 중이었고,
우분투 서버로의 완전한 이전은 보류된 상태였습니다.

이런 배경 때문에 처음부터 인프라나 Nginx 설정을 의심하기보다는,  
**애플리케이션 로직 문제일 가능성이 더 크다고 판단**했습니다.

---

### 1. 애플리케이션 로직 의심

처음 확인한 부분은 인코딩 설정이었습니다.

- 애플리케이션 내부에  
  **EUC-KR과 UTF-8 인코딩이 혼재**되어 있는 것을 발견
- EUC-KR을 사용한 이유가 있었을 것 같지만 별도의 문서나 주석이 없음
- 이로 인해 외부 API 응답 처리 과정에서 문제가 발생할 확률이 높다고 판단

실제로 인코딩을 EUC-KR → UTF-8로 통일한 뒤  
Postman으로 API 엔드포인트를 호출해보니,

- 한글은 깨졌지만
- **DB에는 정상적으로 데이터가 저장되는 것을 확인**

이 시점에서는  
“한글 깨짐 문제만 해결하면 되겠다”라고 판단했습니다.

지금 돌이켜보면,  
이 단계에서 **문제의 범위를 조금 더 넓게 봤어야 했던 부분**이었던 것 같다는 생각이 들었습니다.

UTF-8로 통일했음에도 한글 깨짐이 발생했다는 점에서 기존 인코딩 방식 자체는 문제가 아니었을 가능성이 컸고,
초기 단계에서 Postman 외에도 다양한 환경에서 테스트를 병행했더라면 원인에 더 빨리 접근할 수 있었겠다는 아쉬움이 남습니다.

---

### 2. 문제 재현과 가설 붕괴

인코딩을 수정한 뒤,  
Postman이 아닌 **실제 서비스 환경에서 테스트**를 진행했을 때  
다시 동일한 문제가 발생했습니다.

- 외부 API 응답을 받지 못함
- DB 저장 실패 재현

즉,

- 인코딩 설정은 결과적으로 **문제의 원인이 아니었고**
- 애플리케이션 로직에서도 더 이상 의심할 만한 부분을 찾지 못했습니다
- 인코딩을 롤백한 뒤 Postman 테스트에서는 한글 깨짐 없이 DB 저장이 정상적으로 이루어졌지만,
  실제 서비스 환경에서는 동일한 문제가 다시 발생했습니다.

이로 인해 애플리케이션 단의 문제가 아닐 가능성이 크다고 판단하게 되었습니다.

이 시점에서 다시 처음으로 돌아가  
**환경 차이 자체를 의심하기 시작했습니다.**

---

### 3. 환경 관점에서의 재접근

정리해보면 다음과 같았습니다.

- Windows IIS 환경에서는 문제 없음
- Ubuntu 서버로 이전한 이후에만 문제 발생

이 차이에 주목해  
**Nginx 로그를 본격적으로 확인**했고,  
그 과정에서 중요한 사실을 발견했습니다.

**외부 API의 콜백 요청이 Nginx까지 도달하지 못하고 있었다는 점**입니다.

이후 외부 API 제공 측에 문의하여 에러 코드를 확인했고,  
문제의 원인이 **Nginx의 SSL 보안 설정에 의해 콜백이 필터링되고 있었다는 것**임을 알게 되었습니다.

---

## 기존 환경과 변경된 환경의 차이

### 이전 환경
- Windows IIS 서버
- Tomcat 단독 실행
- HTTPS 설정은 IIS 레벨에서 처리

### 변경된 환경
- Ubuntu 서버
- Docker 컨테이너 환경
- Nginx 리버스 프록시 + SSL 종료(TLS Termination)
- 애플리케이션은 HTTP로 Nginx 뒤에서 동작

환경이 바뀌면서 HTTPS 통신의 책임이  
애플리케이션 → **Nginx**로 이동했다는 점이 가장 큰 차이였습니다.

---

## 문제가 발생했던 SSL 설정

Docker 환경에서 Nginx 설정을 하면서  
보안을 강화하기 위해 **허용할 암호화 방식(cipher suite)을 명시적으로 제한**했습니다.

### SSL 보안 설정 개요

자세한 보안 설정 값은 공개할 수 없지만,  
**TLS 1.2 이상을 기준으로 최신 보안 권장 사항 위주로 구성된 설정**이었으며,  
불필요하거나 취약하다고 판단되는 암호화 방식은 제외된 상태였습니다.

설정 자체만 보면 최신 보안 권장 사항을 잘 따른 것처럼 보였고,  
실제로 **브라우저 접근이나 내부 API 통신에는 문제가 없었습니다.**

---

## 실제 원인: 외부 API와의 암호화 불일치

문제는 **외부 연동 API 호출**에서 발생했습니다.

- 애플리케이션에서 외부 API 호출
- 응답이 오지 않음
- 결제 처리 이후 로직이 진행되지 않아 DB 저장 실패

원인을 추적해보니,  
**외부 API 서버가 사용하는 TLS cipher suite가  
Nginx에서 허용한 목록에 포함되지 않았기 때문**이었습니다.

즉,

- Nginx: “이 암호화 방식만 허용”
- 외부 API: “그중 일부를 사용하지 않음”
- 결과: TLS Handshake 단계에서 통신 실패

애플리케이션 레벨에서는 단순히 “응답 없음”으로 보였지만,  
실제로는 **SSL 단계에서 이미 차단되고 있던 상황**이었습니다.

---

## 해결 방법

해결 방법은 단순했습니다.

- Nginx의 `ssl_ciphers` 설정에  
  **외부 API와 통신 가능한 암호화 방식 일부를 추가**
- 보안 수준을 과도하게 낮추지 않는 선에서 조정

이후 외부 API 응답이 정상적으로 수신되었고,  
DB 저장 문제도 함께 해결되었습니다.

---

## 왜 이런 문제가 발생했을까?

개인적으로 추측해보면 다음과 같습니다.

- 설정 당시 기준으로는 **최신 보안 권장 사항 위주로 적용**
- 외부 연동 API 중 일부가  
  **상대적으로 오래된 암호화 방식을 유지하고 있다는 점까지는 고려되지 않았던 가능성**

이건 누군가의 실수라기보다는,  
**보안 설정에서 자주 발생하는 현실적인 트레이드오프 문제**라고 생각합니다.

---

## 이번 경험을 통해 느낀 점

이 경험을 통해 다시 느낀 점은 다음과 같습니다.

- 보안 설정은 **“최신만 적용하면 된다”로 끝나지 않는다**
- 특히 외부 시스템과 연동되는 서비스에서는
	“보안 강화”와 “호환성” 사이의 균형을 항상 함께 고민해야 한다는 점을
	이번 경험을 통해 느낄 수 있었습니다.
- 문제의 원인이 애플리케이션이 아닐 수도 있다  
  (인프라 / 네트워크 / SSL 단계)

겉으로 보기엔 단순한 “API 응답 실패”였지만,  
실제로는 **서버 환경 변경 + SSL 종료 위치 변경 + 암호화 정책**이  
복합적으로 얽혀 있던 문제였습니다.

---

## 마무리

프로젝트 파일과 서버 접근 권한만 전달받은 상태에서  
기능 흐름이나 설계 배경에 대한 별도의 설명 없이 문제를 파악해야 했기 때문에, 
원인을 찾기까지 생각보다 많은 시간이 소요되었습니다.

또한 저 역시 처음 경험해보는 유형의 문제였던 만큼,  
초기에는 접근 방식이 다소 미숙했던 점도 있었습니다.

하지만 이 경험을 통해,  
서버 이전이나 인프라 구조 변경 시에는  
애플리케이션 코드뿐만 아니라  
**통신 계층(TLS/SSL)까지 함께 점검해야 한다**는 점을 체감할 수 있었습니다.